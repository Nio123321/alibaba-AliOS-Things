# CMake fragment for MicroPython external component
set(MICROPY_EXTERNAL_DIR "${MICROPY_DIR}/../external")

include(CMakePrintHelpers)

if(NOT HAAS_ENGINE_DIR)
    get_filename_component(HAAS_ENGINE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../../ ABSOLUTE)
endif()

set(MICROPY_INC_EXTERNAL
    ${MICROPY_EXTERNAL_DIR}/amp_boot
    ${MICROPY_EXTERNAL_DIR}/amp_task
    ${MICROPY_EXTERNAL_DIR}/amp_utils
    ${MICROPY_EXTERNAL_DIR}/app_mgr
    ${MICROPY_EXTERNAL_DIR}/common
)


if(MICROPY_PY_HTTP)
    list(APPEND MICROPY_INC_EXTERNAL ${HAAS_HTTP_INC})
    list(APPEND MICROPY_SOURCE_EXTERNAL ${HAAS_HTTP_SRC})
    list(APPEND MICROPY_SOURCE_CFLAG ${HAAS_HTTP_CFLAG})
endif()

if(MICROPY_PY_MODBUS)
    list(APPEND MICROPY_INC_EXTERNAL ${HAAS_MODBUS_INC})
    list(APPEND MICROPY_SOURCE_EXTERNAL ${HAAS_MODBUS_SRC})
    list(APPEND MICROPY_SOURCE_CFLAG ${HAAS_MODBUS_CFLAG})
endif()

if(MICROPY_PY_KV)
    list(APPEND MICROPY_INC_EXTERNAL ${HAAS_KV_INC})
    list(APPEND MICROPY_SOURCE_EXTERNAL ${HAAS_KV_SRC})
    list(APPEND MICROPY_SOURCE_CFLAG ${HAAS_KV_CFLAG})
endif()

if(MICROPY_PY_MQTT)
    list(APPEND MICROPY_INC_EXTERNAL ${HAAS_MQTT_INC})
    list(APPEND MICROPY_SOURCE_EXTERNAL ${HAAS_MQTT_SRC})
    list(APPEND MICROPY_SOURCE_CFLAG ${HAAS_MQTT_CFLAG})
endif()


if(MICROPY_PY_SNTP)
    include(${MICROPY_EXTERNAL_DIR}/sntp/sntp.cmake)
    list(APPEND MICROPY_INC_EXTERNAL ${HAAS_SNTP_INC})
    list(APPEND MICROPY_SOURCE_EXTERNAL ${HAAS_SNTP_SRC})
    list(APPEND MICROPY_SOURCE_CFLAG ${HAAS_SNTP_CFLAG})
endif()

if(MICROPY_PY_OTA)
    list(APPEND MICROPY_INC_EXTERNAL ${HAAS_OTA_INC})
    list(APPEND MICROPY_SOURCE_EXTERNAL ${HAAS_OTA_SRC})
    list(APPEND MICROPY_SOURCE_CFLAG ${HAAS_OTA_CFLAG})
endif()

if(MICROPY_PY_ALIYUNIOT)
    list(APPEND MICROPY_INC_EXTERNAL ${HAAS_ALIYUNIOT_INC})
    list(APPEND MICROPY_SOURCE_EXTERNAL ${HAAS_ALIYUNIOT_SRC})
    list(APPEND MICROPY_SOURCE_CFLAG ${HAAS_ALIYUNIOT_CFLAG})
endif()

if(MICROPY_PY_ULOG)
    list(APPEND MICROPY_INC_EXTERNAL ${HAAS_ULOG_INC})
    list(APPEND MICROPY_SOURCE_EXTERNAL ${HAAS_ULOG_SRC})
    list(APPEND MICROPY_SOURCE_CFLAG ${HAAS_ULOG_CFLAG})
endif()

message("####### BEGIN ######")
message("####### BEGIN ######")
message("####### BEGIN ######")
message("####### BEGIN ######")
message("####### BEGIN ######")
cmake_print_variables(MICROPY_SOURCE_EXTERNAL)
message("####### END ######")
message("####### END ######")
message("####### END ######")
message("####### END ######")